<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Fitness Tracker — Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/static/assets/css/styles.css" rel="stylesheet">
</head>
<body>
  <div class="container small">
    <h1>Fitness Tracker</h1>
    <div class="tabs">
      <button class="tab active" data-tab="login">Login</button>
      <button class="tab" data-tab="register">Register</button>
    </div>

    <div class="card" id="login">
      <label>Email</label><input id="login_email" type="email" placeholder="you@example.com">
      <label>Password</label><input id="login_password" type="password" placeholder="••••••••">
      <button id="login_btn">Login</button>
    </div>

    <div class="card hidden" id="register">
      <label>Name</label><input id="r_name" placeholder="Your name">
      <label>Email</label><input id="r_email" type="email" placeholder="you@example.com">
      <label>Password</label><input id="r_password" type="password" placeholder="••••••••">
      <div class="row">
        <div><label>Sex</label>
          <select id="r_sex"><option>male</option><option>female</option></select></div>
        <div><label>Age</label><input id="r_age" type="number" value="25"></div>
      </div>
      <div class="row">
        <div><label>Height (cm)</label><input id="r_height" type="number" value="170"></div>
        <div><label>Weight (kg)</label><input id="r_weight" type="number" value="70"></div>
      </div>
      <div class="row">
        <div><label>Goal</label>
          <select id="r_goal"><option>lose</option><option selected>maintain</option><option>gain</option></select>
        </div>
        <div><label>Activity</label>
          <select id="r_activity">
            <option>sedentary</option><option>light</option><option selected>moderate</option>
            <option>active</option><option>very_active</option></select>
        </div>
      </div>
      <button id="register_btn">Create account</button>
    </div>

    <p class="muted center">Demo build with FastAPI & JSON storage — not for production auth.</p>
  </div>

  <script src="/static/assets/js/common.js"></script>
  <script>
    // Tab logic
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.card').forEach(c=>c.classList.add('hidden'));
        document.getElementById(btn.dataset.tab).classList.remove('hidden');
      });
    });

    // Login
    document.getElementById('login_btn').addEventListener('click', async ()=>{
      const email = document.getElementById('login_email').value.trim();
      const password = document.getElementById('login_password').value;
      try{
        const res = await API.request('/api/auth/login','POST',{email,password});
        saveToken(res.token);
        window.location.href = '/dashboard.html';
      }catch(e){ alert(e.message); }
    });

    // Register
    document.getElementById('register_btn').addEventListener('click', async ()=>{
      const payload = {
        email: document.getElementById('r_email').value.trim(),
        password: document.getElementById('r_password').value,
        name: document.getElementById('r_name').value.trim(),
        sex: document.getElementById('r_sex').value,
        age: parseInt(document.getElementById('r_age').value || '25'),
        height_cm: parseFloat(document.getElementById('r_height').value || '170'),
        weight_kg: parseFloat(document.getElementById('r_weight').value || '70'),
        goal: document.getElementById('r_goal').value,
        activity_level: document.getElementById('r_activity').value
      };
      try{
        await API.request('/api/auth/register','POST',payload);
        const res = await API.request('/api/auth/login','POST',{email: payload.email, password: payload.password});
        saveToken(res.token);
        window.location.href = '/dashboard.html';
      }catch(e){ alert(e.message); }
    });
  </script>
</body>
</html>
